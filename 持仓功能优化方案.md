# “我的持仓” 功能深度优化与 UI/UX 升级方案

**文档日期**: 2026-02-20  
**状态**: 提案阶段  
**目标**: 提升 Earnlytics 持仓页面的专业度、交互体验及视觉高级感。

---

## 1. 功能维度优化 (Functional Intelligence)

目前的持仓功能已完成基础的 CRUD（增删改查），下一步应转向“智能化”和“深度关联”。

### 1.1 实时价格与行情动态
- **实时刷新机制**: 引入价格定时拉取或 WebSocket，并在 UI 上通过微微闪烁的绿色/红色文字表示价格波动。
- **迷你分时图 (Sparklines)**: 在持仓列表的“现价”旁增加过去 7 天的趋势小图，直观展示近期表现。

### 1.2 财报生命周期追踪 (Feature 6 增强版)
- **财报临近预警**: 若持仓公司在 7 天内发布财报，在列表项显示一个带脉冲动效的标识。
- **发布日高亮**: 发布日当天，背景色或边框色变为品牌强调色，并引导用户直接查看“预测雷达图”。

### 1.3 资产分配可视化
- **Bento Grid 数据块**: 将单一的数字卡片改为错落有致的“便当盒”布局，包含：
  - **总资产环形图**: 动态展示不同股票的市值占比。
  - **行业/板块分布**: 展示投资在科技、医疗、金融等领域的比例，帮助用户监控风险。

---

## 2. 交互体验升级 (UX Smoothness)

### 2.1 渐进式信息揭示 (Progressive Disclosure)
- **可折叠子行 (Expandable Rows)**: 
  - 默认态：显示 Symbol, Logo, 成本, 现价, 总盈亏。
  - 展开态：显示 AI 摘要、上次财报表现、成交详情以及“跳转公司详情”的快捷入口。
- **侧边抽屉预览 (Drawer)**: 点击某条持仓，从右侧滑出抽屉，展示该公司在该季度的“超预期雷达图”和 AI 观点预览。

### 2.2 加载与反馈机制
- **骨架屏 (Skeleton Screens)**: 取代单一的 Loader，按照列表和卡片的轮廓进行占位，提升感知速度。
- **空状态指引**: 当没有持仓时，除了“添加”按钮，可以放置 2-3 个热门美股（如 AAPL, TSLA）作为“试用装”点击一键模拟添加。

---

## 3. 视觉设计进化 (Premium Aesthetics)

设计目标是打造一种类似 **Apple Wallet** 或 **Robinhood** 的极简且高级的黑金色/靛蓝色质感。

### 3.1 材质与光影
- **Glassmorphism (玻璃拟态)**: 卡片背景使用 `bg-surface/80` 配合 `backdrop-filter: blur(12px)`。
- **动态边框 (Glow Border)**: 鼠标悬停在持仓项上时，边框产生一道跟随鼠标移动的微光效果。

### 3.2 动效增强 (Framer Motion)
- **Staggered Entrance**: 页面加载时，各项数据卡片和持仓列表按序列左右滑入，而不是僵硬地瞬间出现。
- **数值跳动动画**: 总市值和盈亏金额加减时，数字有一个快速滚动的跳动效果。

---

## 4. 推荐实施路线图

### 第一阶段：视觉与基础组件 (Quick Wins)
1. **重构 Summary 布局**: 采用 Bento Grid 风格。
2. **引入 Framer Motion 动效**: 增加卡片入场和悬停反馈。
3. **优化列表页卡片材质**: 使用玻璃拟态。

### 第二阶段：数据深度关联 (Mid-term)
1. **集成 Sparkline 指标**: 展示股价 7 日趋势。
2. **开发持仓专用 Drawer**: 实现快速查看 AI 摘要。
3. **增加财报临近提醒标识**。

### 第三阶段：全自动化与图表 (Advanced)
1. **持仓分配饼图**: 动态计算并展示权重。
2. **历史净值曲线**: 记录并可视化总资产变化。
3. **AI 组合简报**: 每日生成一两句关于持仓变动的 AI 评论。

### 第四阶段：实时行情与同步 (Infrastructure & Real-time) ✅ 已完成
1. **主动过期更新机制**: 修改 `api/portfolio` 逻辑，加入 15 分钟股价过期校验，自动同步最新行情。
2. **前端定时轮询**: 为持仓页面设置自动刷新逻辑（建议 5 分钟/次），使资产盈亏动态化。
3. **性能优化**: 实现多 Symbol 并行抓取与 Supabase 批量更新，确保响应速度。

---

**备注**: 以上方案均遵循 `AGENTS.md` 中的设计规范，优先使用 `Tailwind CSS 4.0` 与 `Framer Motion`。
