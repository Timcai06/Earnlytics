# Earnlytics 技术架构

> 基于实际代码的技术栈与系统设计  
> **更新**: 2026-02-15

---

## 技术栈

| 层级 | 技术 | 版本 |
|------|------|------|
| 前端框架 | Next.js | 16.x |
| UI库 | React | 19.x |
| 语言 | TypeScript | 5.x |
| 样式 | Tailwind CSS | 4.x |
| 组件库 | shadcn/ui | Latest |
| 数据库 | Supabase PostgreSQL | - |
| AI | DeepSeek API | - |
| 部署 | Vercel | - |

### 外部服务
- **FMP API**: 财报数据
- **DeepSeek API**: AI分析
- **Resend**: 邮件发送
- **SEC EDGAR**: 官方财报文档

---

## 项目结构

```
earnlytics-web/src/
├── app/                    # 13个页面
│   ├── (auth)/            # 认证页面
│   │   ├── login/
│   │   └── signup/
│   ├── home/              # 首页
│   ├── companies/         # 公司列表
│   ├── calendar/          # 财报日历
│   ├── earnings/[symbol]/ # 财报详情
│   ├── analysis/[symbol]/ # 深度分析
│   ├── dashboard/         # 仪表板
│   ├── profile/           # 用户资料
│   ├── privacy/          # 隐私政策
│   ├── terms/            # 服务条款
│   └── api/              # 17个API路由
├── components/
│   ├── investment/       # 10个投资组件
│   ├── ui/               # shadcn/ui组件
│   └── layout/           # 布局组件
└── lib/                  # 工具函数
```

---

## 系统架构

```
用户 → Vercel Edge → Next.js App → Supabase
                               ↓            ↓
                          API Routes    PostgreSQL
                               ↓
                          DeepSeek API
```

---

## 14个页面

| 路由 | 功能 |
|------|------|
| `/` | Landing Page |
| `/home` | 首页 |
| `/companies` | 公司列表 |
| `/calendar` | 财报日历 |
| `/earnings/[symbol]` | 财报详情 |
| `/analysis/[symbol]` | 深度分析 |
| `/dashboard` | 仪表板 |
| `/profile` | 用户资料 |
| `/privacy` | 隐私政策 |
| `/terms` | 服务条款 |
| `/login` | 登录 |
| `/signup` | 注册 |
| `/contact` | 联系我们 |
| `/*` | 404 |

---

## 17个API路由

### 基础数据
| 路由 | 方法 | 用途 |
|------|------|------|
| `/api/companies` | GET | 公司列表 |
| `/api/earnings` | GET | 财报列表 |
| `/api/earnings/[id]` | GET | 财报详情 |
| `/api/earnings/[id]/document` | GET | 财报文档 |
| `/api/sectors` | GET | 行业分类 |
| `/api/calendar` | GET | 财报日历 |

### 高级分析
| 路由 | 方法 | 用途 |
|------|------|------|
| `/api/analysis/[symbol]` | GET | 深度分析 |
| `/api/valuation/[symbol]` | GET | 估值数据 |
| `/api/research/[symbol]` | GET | 研报聚合 |
| `/api/peers/[symbol]` | GET | 同行对比 |
| `/api/stock-price/[symbol]` | GET | 股价数据 |

### 用户系统
| 路由 | 方法 | 用途 |
|------|------|------|
| `/api/subscribe` | POST | 邮件订阅 |
| `/api/alerts` | GET/POST | 警报管理 |
| `/api/nps` | POST | NPS调查 |
| `/api/feedback` | POST | 用户反馈 |
| `/api/assistant/chat` | POST | AI助手 |

---

## 10个Investment组件

| 组件 | 用途 |
|------|------|
| InvestmentRatingCard | AI投资评级 |
| FinancialHealthScorecard | 财务健康 |
| DocumentViewer | 财报文档 |
| IndustryComparisonChart | 行业对比 |
| DupontAnalysisChart | 杜邦分析 |
| GrowthStageChart | 成长阶段 |
| ValuationGauge | 估值仪表盘 |
| ChatInterface | AI聊天 |
| AlertManagement | 警报管理 |
| NotificationPreferences | 通知偏好 |

---

## 9个数据库迁移

| 文件 | 内容 |
|------|------|
| 001_initial_schema | companies, earnings, ai_analyses, subscribers |
| 002_insert_test_earnings | 测试数据 |
| 003_insert_tier2_companies | Tier 2公司 |
| 004_add_data_source | 数据源 |
| 005_investment_system | 估值/研报/分析师 |
| 006_vector_embeddings | RAG/对话历史 |
| 007_alert_system | 警报系统 |
| 20260212_feedback | 反馈/NPS |
| 20260213_stock_prices | 股价数据 |

---

## 数据库表

### 基础表
- `companies` - 公司信息
- `earnings` - 财报数据
- `ai_analyses` - AI分析结果
- `subscribers` - 邮件订阅

### 投资系统 (005)
- `company_valuation` - 公司估值
- `industry_benchmarks` - 行业基准
- `peer_comparison` - 竞争对比
- `research_reports` - 研报
- `analyst_tracking` - 分析师追踪

### AI系统 (006)
- `document_embeddings` - 文档向量
- `chat_conversations` - 对话历史

### 警报系统 (007)
- `alert_rules` - 警报规则
- `alert_history` - 警报历史

### 反馈系统 (20260212)
- `feedback` - 用户反馈
- `nps_surveys` - NPS调查

### 股价 (20260213)
- `stock_prices` - 股价历史

---

## 自动化

### GitHub Actions
- 每4小时自动获取财报数据
- 自动AI分析
- 触发Vercel重新部署

### 数据脚本
- `fetch-earnings.ts` - 获取财报
- `analyze-batch.ts` - 批量AI分析
- `send-digests.ts` - 邮件摘要

---

## 环境变量

```bash
# 公开
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=

# 私密
FMP_API_KEY=
DEEPSEEK_API_KEY=
SUPABASE_SERVICE_ROLE_KEY=
```

---

**相关文档**:
- [项目总览](../计划/00-项目总览.md)
- [状态报告](../项目状态报告-20260214.md)
