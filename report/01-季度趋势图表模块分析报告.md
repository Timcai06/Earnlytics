# å­£åº¦è¶‹åŠ¿å¯¹æ¯”æ¨¡å—æ·±åº¦åˆ†ææŠ¥å‘Š

**åˆ†ææ—¥æœŸ**: 2026-02-12  
**åˆ†æå¯¹è±¡**: `/app/earnings/[symbol]/page.tsx` ä¸­çš„å­£åº¦è¶‹åŠ¿å¯¹æ¯”æ¨¡å—  
**å…³è”ç»„ä»¶**: `EarningsTrendChart.tsx`  
**æ–‡ä»¶ä½ç½®**: 
- `src/app/earnings/[symbol]/page.tsx` (ç¬¬286-314è¡Œ)
- `src/components/sections/EarningsTrendChart.tsx`

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

å­£åº¦è¶‹åŠ¿å¯¹æ¯”æ¨¡å—æ˜¯ earnings page çš„æ ¸å¿ƒæ•°æ®å¯è§†åŒ–ç»„ä»¶ï¼Œå±•ç¤ºå…¬å¸å†å²è´¢æŠ¥æ•°æ®çš„è¥æ”¶ã€EPSå’ŒåŒæ¯”å¢é•¿è¶‹åŠ¿ã€‚ç»è¿‡æ·±åº¦ä»£ç åˆ†æï¼Œå‘ç°äº† **15ä¸ªå…·ä½“é—®é¢˜**ï¼Œæ¶µç›–æ€§èƒ½ã€ç”¨æˆ·ä½“éªŒã€æ•°æ®å‡†ç¡®æ€§ã€å¯è®¿é—®æ€§å’Œä»£ç è´¨é‡äº”ä¸ªç»´åº¦ã€‚

### ä¸¥é‡ç¨‹åº¦åˆ†å¸ƒ

| ç­‰çº§ | æ•°é‡ | ç±»åˆ« |
|------|------|------|
| ğŸ”´ ä¸¥é‡ | 3 | æ€§èƒ½é—®é¢˜ã€æ•°æ®å‡†ç¡®æ€§ |
| ğŸŸ¡ ä¸­ç­‰ | 6 | ç”¨æˆ·ä½“éªŒã€äº¤äº’è®¾è®¡ |
| ğŸŸ¢ å»ºè®® | 6 | ä»£ç è´¨é‡ã€å¯è®¿é—®æ€§ |

### å…³é”®å‘ç°

1. **æ€§èƒ½éšæ‚£**: å¤§æ•°æ®é‡æ—¶å›¾è¡¨æ¸²æŸ“æ€§èƒ½ä¸‹é™ï¼ŒåŠ¨ç”»å¯èƒ½é€ æˆå¡é¡¿
2. **æ•°æ®é—®é¢˜**: æ—¶é—´èŒƒå›´è¿‡æ»¤é€»è¾‘æœ‰ç¼ºé™·ï¼Œç¯æ¯”è®¡ç®—å­˜åœ¨è¾¹ç•Œæƒ…å†µæœªå¤„ç†
3. **äº¤äº’ç¼ºå¤±**: ç¼ºå°‘å›¾è¡¨ç¼©æ”¾ã€å¹³ç§»ã€æ•°æ®ç‚¹è¯¦æƒ…æŸ¥çœ‹ç­‰é«˜çº§äº¤äº’
4. **ç§»åŠ¨é€‚é…**: ç§»åŠ¨ç«¯å›¾è¡¨ä½“éªŒå·®ï¼Œå·¥å…·æç¤ºå¯èƒ½è¶…å‡ºè§†å£
5. **å¯è®¿é—®æ€§**: å®Œå…¨ç¼ºå¤± ARIA æ ‡ç­¾ã€é”®ç›˜å¯¼èˆªæ”¯æŒ

---

## ğŸ”´ ä¸¥é‡é—®é¢˜

### 1. æ€§èƒ½é—®é¢˜ - ä¸å¿…è¦çš„æ•°æ®é‡è®¡ç®—

**ä½ç½®**: `EarningsTrendChart.tsx:191-197`

```typescript
const processedData = useMemo(() => {
  const sorted = [...data].sort(
    (a, b) => new Date(a.date).getTime() - new Date(b.date).getTime()
  );
  const filtered = filterDataByTimeRange(sorted, timeRange);
  return calculateQoQGrowth(filtered);
}, [data, timeRange]);
```

**é—®é¢˜åˆ†æ**:
- æ¯æ¬¡ `data` æˆ– `timeRange` å˜åŒ–æ—¶ï¼Œæ•´ä¸ªæ•°æ®ç®¡é“é‡æ–°æ‰§è¡Œ
- `calculateQoQGrowth` éå†æ‰€æœ‰æ•°æ®è®¡ç®—ç¯æ¯”ï¼Œæ—¶é—´å¤æ‚åº¦ O(n)
- å½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼ˆå¦‚5å¹´20ä¸ªå­£åº¦ï¼‰ï¼Œæ’åº+è¿‡æ»¤+è®¡ç®—ç»„åˆæ“ä½œé€ æˆæ˜æ˜¾å¡é¡¿

**å½±å“**:
- ç”¨æˆ·åˆ‡æ¢æ—¶é—´èŒƒå›´æ—¶ç•Œé¢æ— å“åº”
- ç§»åŠ¨ç«¯ä½ç«¯è®¾å¤‡ä¸Šå¯èƒ½å‡ºç°å¸§ç‡ä¸‹é™

**ä¿®å¤å»ºè®®**:

```typescript
// ä½¿ç”¨åˆ†å±‚ç¼“å­˜ç­–ç•¥
const sortedData = useMemo(() => {
  return [...data].sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
}, [data]);

const filteredData = useMemo(() => {
  return filterDataByTimeRange(sortedData, timeRange);
}, [sortedData, timeRange]);

const processedData = useMemo(() => {
  return calculateQoQGrowth(filteredData);
}, [filteredData]);

// å¯¹äºè¶…å¤§æ•°æ®é›†ï¼Œè€ƒè™‘ä½¿ç”¨ Web Worker
const { data: processedData, isLoading } = useChartDataProcessor(data, timeRange);
```

**ä¼˜å…ˆçº§**: P0  
**é¢„ä¼°å·¥ä½œé‡**: 2å°æ—¶

---

### 2. æ•°æ®å‡†ç¡®æ€§ - ç¯æ¯”è®¡ç®—è¾¹ç•Œæƒ…å†µ

**ä½ç½®**: `EarningsTrendChart.tsx:70-79`

```typescript
function calculateQoQGrowth(data: TrendData[]): TrendData[] {
  return data.map((item, index) => {
    if (index === 0) return { ...item, qoqGrowth: null };
    const prevRevenue = data[index - 1].revenue;
    const currRevenue = item.revenue;
    if (!prevRevenue || !currRevenue) return { ...item, qoqGrowth: null };
    const qoqGrowth = ((currRevenue - prevRevenue) / prevRevenue) * 100;
    return { ...item, qoqGrowth: Number(qoqGrowth.toFixed(1)) };
  });
}
```

**é—®é¢˜åˆ†æ**:
1. **è·¨è´¢å¹´é—®é¢˜**: FY23 Q4 åˆ° FY24 Q1 ä¸æ˜¯è¿ç»­çš„å­£åº¦ï¼Œä¸åº”è®¡ç®—ç¯æ¯”
2. **ç¼ºå¤±æ•°æ®å¤„ç†**: ä¸­é—´æœ‰ç¼ºå¤±å­£åº¦æ—¶ï¼Œç¯æ¯”è®¡ç®—ä»ä½¿ç”¨æ•°ç»„ç´¢å¼•ï¼Œå¯¼è‡´é”™è¯¯
3. **é™¤é›¶é£é™©**: `prevRevenue` ä¸º 0 æ—¶ä¼šäº§ç”Ÿ Infinity

**ä¿®å¤å»ºè®®**:

```typescript
function calculateQoQGrowth(data: TrendData[]): TrendData[] {
  return data.map((item, index) => {
    if (index === 0) return { ...item, qoqGrowth: null };
    
    // æ‰¾åˆ°çœŸæ­£çš„ä¸Šä¸€å­£åº¦ï¼ˆæŒ‰æ—¶é—´é¡ºåºï¼‰
    const prevItem = data[index - 1];
    const currDate = new Date(item.date);
    const prevDate = new Date(prevItem.date);
    
    // éªŒè¯æ˜¯å¦è¿ç»­å­£åº¦ï¼ˆçº¦90å¤©é—´éš”ï¼‰
    const daysDiff = (currDate.getTime() - prevDate.getTime()) / (1000 * 60 * 60 * 24);
    const isConsecutiveQuarter = daysDiff >= 80 && daysDiff <= 100;
    
    if (!isConsecutiveQuarter) {
      return { ...item, qoqGrowth: null };
    }
    
    const prevRevenue = prevItem.revenue;
    const currRevenue = item.revenue;
    
    if (!prevRevenue || !currRevenue || prevRevenue === 0) {
      return { ...item, qoqGrowth: null };
    }
    
    const qoqGrowth = ((currRevenue - prevRevenue) / prevRevenue) * 100;
    return { ...item, qoqGrowth: Number(qoqGrowth.toFixed(1)) };
  });
}
```

**ä¼˜å…ˆçº§**: P0  
**é¢„ä¼°å·¥ä½œé‡**: 1.5å°æ—¶

---

### 3. æ—¶é—´èŒƒå›´è¿‡æ»¤é€»è¾‘ç¼ºé™·

**ä½ç½®**: `EarningsTrendChart.tsx:60-68`

```typescript
function filterDataByTimeRange(data: TrendData[], range: TimeRange): TrendData[] {
  if (range === "ALL") return data;

  const now = new Date();
  const years = range === "1Y" ? 1 : range === "3Y" ? 3 : 5;
  const cutoffDate = new Date(now.getFullYear() - years, now.getMonth(), 1);

  return data.filter((item) => new Date(item.date) >= cutoffDate);
}
```

**é—®é¢˜åˆ†æ**:
- ä½¿ç”¨å½“å‰æ—¥æœŸè®¡ç®—æˆªæ–­ç‚¹ï¼Œä½†è´¢æŠ¥æ•°æ®é€šå¸¸æ˜¯å†å²æ•°æ®
- å¦‚æœæœ€æ–°è´¢æŠ¥æ˜¯3ä¸ªæœˆå‰ï¼Œé€‰æ‹©"1Y"ä¼šä¸¢å¤±æœ€è¿‘æ•°æ®
- åº”è¯¥åŸºäºæ•°æ®ä¸­æœ€æ–°çš„è´¢æŠ¥æ—¥æœŸè®¡ç®—ï¼Œè€Œéå½“å‰æ—¥æœŸ

**ä¿®å¤å»ºè®®**:

```typescript
function filterDataByTimeRange(data: TrendData[], range: TimeRange): TrendData[] {
  if (range === "ALL" || data.length === 0) return data;

  // åŸºäºæœ€æ–°æ•°æ®æ—¥æœŸè€Œéå½“å‰æ—¥æœŸ
  const latestDate = new Date(Math.max(...data.map(d => new Date(d.date).getTime())));
  const years = range === "1Y" ? 1 : range === "3Y" ? 3 : 5;
  const cutoffDate = new Date(latestDate.getFullYear() - years, latestDate.getMonth(), latestDate.getDate());

  return data.filter((item) => new Date(item.date) >= cutoffDate);
}
```

**ä¼˜å…ˆçº§**: P0  
**é¢„ä¼°å·¥ä½œé‡**: 30åˆ†é’Ÿ

---

## ğŸŸ¡ ä¸­ç­‰é—®é¢˜

### 4. å›¾è¡¨åŠ¨ç”»æ€§èƒ½é—®é¢˜

**ä½ç½®**: å¤šå¤„ï¼Œå¦‚ `EarningsTrendChart.tsx:307-324`

```typescript
<Bar
  yAxisId="left"
  dataKey="revenue"
  radius={[4, 4, 0, 0]}
  animationDuration={1000}  // åŠ¨ç”»æŒç»­1ç§’
  animationEasing="ease-out"
/>
<Line
  // ...
  animationDuration={1000}  // åŠ¨ç”»æŒç»­1ç§’
  animationEasing="ease-out"
/>
```

**é—®é¢˜åˆ†æ**:
- æ‰€æœ‰å›¾è¡¨å…ƒç´ éƒ½æœ‰1ç§’åŠ¨ç”»
- ç”¨æˆ·å¿«é€Ÿåˆ‡æ¢æ•°æ®ç±»å‹æˆ–æ—¶é—´èŒƒå›´æ—¶ï¼ŒåŠ¨ç”»ä¼šç´¯ç§¯é€ æˆå¡é¡¿
- ç§»åŠ¨ç«¯ GPU æ€§èƒ½æœ‰é™ï¼Œå¤æ‚åŠ¨ç”»å¯èƒ½å¯¼è‡´æ‰å¸§

**ä¿®å¤å»ºè®®**:

```typescript
// 1. æ ¹æ®è®¾å¤‡æ€§èƒ½åŠ¨æ€è°ƒæ•´åŠ¨ç”»
const isMobile = typeof window !== 'undefined' && window.innerWidth < 768;
const prefersReducedMotion = typeof window !== 'undefined' && 
  window.matchMedia('(prefers-reduced-motion: reduce)').matches;

const animationConfig = useMemo(() => {
  if (prefersReducedMotion) return { isAnimationActive: false };
  if (isMobile) return { animationDuration: 300 };
  return { animationDuration: 600 };
}, [isMobile, prefersReducedMotion]);

// 2. å¿«é€Ÿåˆ‡æ¢æ—¶ç¦ç”¨åŠ¨ç”»
const [isAnimating, setIsAnimating] = useState(false);

const handleDataTypeChange = (type: DataType) => {
  if (isAnimating) return;
  setIsAnimating(true);
  setDataType(type);
  setTimeout(() => setIsAnimating(false), 300);
};
```

**ä¼˜å…ˆçº§**: P1  
**é¢„ä¼°å·¥ä½œé‡**: 1å°æ—¶

---

### 5. å·¥å…·æç¤ºå®šä½é—®é¢˜

**ä½ç½®**: `EarningsTrendChart.tsx:81-179`

**é—®é¢˜åˆ†æ**:
- Recharts é»˜è®¤å·¥å…·æç¤ºå®šä½å¯èƒ½åœ¨è§†å£ä¹‹å¤–
- é¼ æ ‡é è¿‘è¾¹ç¼˜æ—¶å·¥å…·æç¤ºè¢«æˆªæ–­
- ç§»åŠ¨ç«¯è§¦æ‘¸æ—¶å·¥å…·æç¤ºæ˜¾ç¤ºä½ç½®ä¸ç²¾ç¡®

**ä¿®å¤å»ºè®®**:

```typescript
// ä½¿ç”¨å›ºå®šå®šä½çš„å·¥å…·æç¤º
function CustomTooltip({ active, payload, label, coordinate }: TooltipProps) {
  if (!active || !payload) return null;
  
  // è®¡ç®—å®‰å…¨ä½ç½®
  const tooltipRef = useRef<HTMLDivElement>(null);
  const [position, setPosition] = useState({ x: 0, y: 0 });
  
  useEffect(() => {
    if (coordinate && tooltipRef.current) {
      const rect = tooltipRef.current.getBoundingClientRect();
      const viewportWidth = window.innerWidth;
      const viewportHeight = window.innerHeight;
      
      let x = coordinate.x;
      let y = coordinate.y - rect.height - 10;
      
      // è¾¹ç•Œæ£€æµ‹
      if (x + rect.width > viewportWidth) x = viewportWidth - rect.width - 10;
      if (x < 10) x = 10;
      if (y < 10) y = coordinate.y + 10;
      
      setPosition({ x, y });
    }
  }, [coordinate]);
  
  return (
    <div
      ref={tooltipRef}
      className="fixed z-50 bg-[#18181B] border border-[#3F3F46] rounded-lg p-3 shadow-lg"
      style={{ left: position.x, top: position.y }}
    >
      {/* å·¥å…·æç¤ºå†…å®¹ */}
    </div>
  );
}
```

**ä¼˜å…ˆçº§**: P1  
**é¢„ä¼°å·¥ä½œé‡**: 1.5å°æ—¶

---

### 6. ç¼ºå°‘æ•°æ®ç‚¹äº¤äº’

**ä½ç½®**: `EarningsTrendChart.tsx:43-395`

**é—®é¢˜åˆ†æ**:
- ç”¨æˆ·æ— æ³•ç‚¹å‡»æ•°æ®ç‚¹æŸ¥çœ‹è¯¦æƒ…
- æ— æ³•é«˜äº®ç‰¹å®šå­£åº¦æ•°æ®
- ç¼ºå°‘æ•°æ®å¯¹æ¯”åŠŸèƒ½

**ä¿®å¤å»ºè®®**:

```typescript
const [selectedPoint, setSelectedPoint] = useState<string | null>(null);

// åœ¨å›¾è¡¨é…ç½®ä¸­æ·»åŠ ç‚¹å‡»äº‹ä»¶
<Bar
  dataKey={dataKey}
  onClick={(data) => {
    setSelectedPoint(data.quarter);
    onDataPointClick?.(data);
  }}
>
  {processedData.map((entry, index) => (
    <Cell
      key={`cell-${index}`}
      fill={getBarColor(entry)}
      opacity={selectedPoint === entry.quarter ? 1 : 0.7}
      cursor="pointer"
    />
  ))}
</Bar>

// æ·»åŠ ç‚¹å‡»åçš„è¯¦æƒ…é¢æ¿
{selectedPoint && (
  <DataPointDetails 
    quarter={selectedPoint}
    data={processedData.find(d => d.quarter === selectedPoint)}
    onClose={() => setSelectedPoint(null)}
  />
)}
```

**ä¼˜å…ˆçº§**: P1  
**é¢„ä¼°å·¥ä½œé‡**: 2å°æ—¶

---

### 7. ç§»åŠ¨ç«¯é€‚é…ä¸è¶³

**ä½ç½®**: `page.tsx:286-314`, `EarningsTrendChart.tsx:397-498`

**é—®é¢˜åˆ†æ**:
1. **æ§åˆ¶æŒ‰é’®è¿‡äºæ‹¥æŒ¤**: åœ¨ç§»åŠ¨ç«¯æ‰€æœ‰æ§åˆ¶æŒ‰é’®æ’æˆä¸€è¡Œï¼Œç©ºé—´ä¸è¶³
2. **å›¾è¡¨é«˜åº¦å›ºå®š**: 300px é«˜åº¦åœ¨ç§»åŠ¨ç«¯å¯èƒ½è¿‡é«˜æˆ–è¿‡ä½
3. **è§¦æ‘¸ç›®æ ‡è¿‡å°**: æ•°æ®ç‚¹å¤ªå°ï¼Œéš¾ä»¥ç²¾ç¡®è§¦æ‘¸

**å½“å‰ä»£ç **:
```typescript
<div className="flex flex-wrap items-center gap-2">
  {/* æ•°æ®ç±»å‹æŒ‰é’®ã€å›¾è¡¨ç±»å‹æŒ‰é’®ã€æ—¶é—´èŒƒå›´æŒ‰é’®ã€å¯¼å‡ºæŒ‰é’®å…¨éƒ¨å †åœ¨ä¸€èµ· */}
</div>
```

**ä¿®å¤å»ºè®®**:

```typescript
// 1. å“åº”å¼æ§åˆ¶é¢æ¿
<div className="flex flex-col sm:flex-row gap-2">
  <div className="flex items-center gap-2 overflow-x-auto pb-2 sm:pb-0">
    {/* ä¸»è¦æ§åˆ¶æŒ‰é’® */}
  </div>
  <div className="flex items-center gap-2 sm:ml-auto">
    {/* æ¬¡è¦æ§åˆ¶ */}
  </div>
</div>

// 2. å“åº”å¼å›¾è¡¨é«˜åº¦
<div className={cn(
  "w-full",
  "h-[250px] sm:h-[300px] lg:h-[400px]"
)}>
  <ResponsiveContainer width="100%" height="100%">
    {/* å›¾è¡¨ */}
  </ResponsiveContainer>
</div>

// 3. ç§»åŠ¨ç«¯å¢å¤§è§¦æ‘¸ç›®æ ‡
<Bar
  dataKey={dataKey}
  // ç§»åŠ¨ç«¯å¢å¤§æŸ±çŠ¶å›¾å®½åº¦
  barSize={isMobile ? 24 : 16}
>
```

**ä¼˜å…ˆçº§**: P1  
**é¢„ä¼°å·¥ä½œé‡**: 2å°æ—¶

---

### 8. å¯¼å‡ºåŠŸèƒ½ç¼ºä¹æ ¼å¼é€‰é¡¹

**ä½ç½®**: `EarningsTrendChart.tsx:199-212`

**å½“å‰å®ç°**:
```typescript
const exportData = () => {
  const csvContent = [
    ["å­£åº¦", "æ—¥æœŸ", "è¥æ”¶", "EPS", "åŒæ¯”å¢é•¿", "ç¯æ¯”å¢é•¿"].join(","),
    ...processedData.map((item) =>
      [item.quarter, item.date, item.revenue, item.eps, item.revenueGrowth, item.qoqGrowth].join(",")
    ),
  ].join("\n");
  // ... ä¸‹è½½é€»è¾‘
};
```

**é—®é¢˜åˆ†æ**:
- ä»…æ”¯æŒ CSV æ ¼å¼
- æ•°æ®æœªæ ¼å¼åŒ–ï¼ˆå¦‚è¥æ”¶æ˜¾ç¤ºä¸ºåŸå§‹æ•°å­—è€Œé $12.5Bï¼‰
- ç¼ºå°‘å¯¼å‡ºå›¾ç‰‡åŠŸèƒ½

**ä¿®å¤å»ºè®®**:

```typescript
const exportData = (format: 'csv' | 'json' | 'png') => {
  switch (format) {
    case 'csv':
      exportToCSV(processedData);
      break;
    case 'json':
      exportToJSON(processedData);
      break;
    case 'png':
      exportToPNG(chartRef.current);
      break;
  }
};

// æ ¼å¼åŒ–å¯¼å‡ºæ•°æ®
const formatExportValue = (value: number | null, type: 'currency' | 'percentage') => {
  if (value === null) return 'N/A';
  if (type === 'currency') return formatCurrency(value);
  return `${value.toFixed(1)}%`;
};
```

**ä¼˜å…ˆçº§**: P2  
**é¢„ä¼°å·¥ä½œé‡**: 2å°æ—¶

---

### 9. å›¾è¡¨ç±»å‹åˆ‡æ¢çŠ¶æ€ä¸¢å¤±

**ä½ç½®**: `EarningsTrendChart.tsx:437-457`

**é—®é¢˜åˆ†æ**:
- åˆ‡æ¢å›¾è¡¨ç±»å‹æ—¶ï¼ˆå¦‚ä»æŸ±çŠ¶å›¾åˆ‡æ¢åˆ°æŠ˜çº¿å›¾ï¼‰ï¼ŒåŠ¨ç”»é‡æ–°æ’­æ”¾
- ç”¨æˆ·å¯èƒ½å¸Œæœ›ä¿æŒç›¸åŒçš„è§†è§’å’Œç¼©æ”¾çŠ¶æ€
- åŒè½´å›¾è¡¨åˆ‡æ¢å›å•è½´æ—¶ Y è½´èŒƒå›´é‡ç½®

**ä¿®å¤å»ºè®®**:

```typescript
// ä½¿ç”¨ React.memo ç¼“å­˜å›¾è¡¨ç»„ä»¶
const ChartComponent = useMemo(() => {
  switch (chartType) {
    case 'dual': return DualAxisChart;
    case 'line': return LineChartView;
    case 'area': return AreaChartView;
    default: return BarChartView;
  }
}, []); // ä¸ä¾èµ– chartTypeï¼Œé¿å…é‡æ–°åˆ›å»º

// ä¿æŒ Y è½´èŒƒå›´
const [yAxisDomain, setYAxisDomain] = useState<[number, number] | ['auto', 'auto']>(['auto', 'auto']);

// å½“ç”¨æˆ·æ‰‹åŠ¨ç¼©æ”¾æ—¶ä¿å­˜èŒƒå›´
const handleZoom = (domain: [number, number]) => {
  setYAxisDomain(domain);
};
```

**ä¼˜å…ˆçº§**: P2  
**é¢„ä¼°å·¥ä½œé‡**: 1.5å°æ—¶

---

## ğŸŸ¢ å»ºè®®æ”¹è¿›

### 10. å®Œå…¨ç¼ºå¤±å¯è®¿é—®æ€§æ”¯æŒ

**é—®é¢˜åˆ†æ**:
- æ²¡æœ‰ ARIA æ ‡ç­¾
- é”®ç›˜å¯¼èˆªä¸æ”¯æŒ
- å±å¹•é˜…è¯»å™¨æ— æ³•è¯»å–å›¾è¡¨æ•°æ®

**ä¿®å¤å»ºè®®**:

```typescript
// 1. æ·»åŠ  ARIA å±æ€§
<div 
  role="region" 
  aria-label="å­£åº¦è¶‹åŠ¿å¯¹æ¯”å›¾è¡¨"
  aria-describedby="chart-description"
>
  <p id="chart-description" className="sr-only">
    å±•ç¤ºå…¬å¸å†å²è´¢æŠ¥æ•°æ®ï¼ŒåŒ…æ‹¬è¥æ”¶ã€æ¯è‚¡æ”¶ç›Šå’ŒåŒæ¯”å¢é•¿ç‡çš„è¶‹åŠ¿ã€‚
    ä½¿ç”¨ä¸‹æ–¹çš„æŒ‰é’®å¯ä»¥åˆ‡æ¢æ•°æ®ç±»å‹å’Œæ—¶é—´èŒƒå›´ã€‚
  </p>
  
  <ResponsiveContainer>
    <BarChart
      role="img"
      aria-label="è¥æ”¶è¶‹åŠ¿æŸ±çŠ¶å›¾"
    >
      {/* å›¾è¡¨ */}
    </BarChart>
  </ResponsiveContainer>
</div>

// 2. é”®ç›˜å¯¼èˆªæ”¯æŒ
const handleKeyDown = (e: KeyboardEvent, dataPoint: TrendData) => {
  switch (e.key) {
    case 'Enter':
    case ' ':
      setSelectedPoint(dataPoint.quarter);
      break;
    case 'ArrowRight':
      // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ•°æ®ç‚¹
      focusNextDataPoint();
      break;
    case 'ArrowLeft':
      // ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªæ•°æ®ç‚¹
      focusPrevDataPoint();
      break;
  }
};

// 3. æä¾›æ›¿ä»£æ–‡æœ¬
<div className="sr-only">
  <table>
    <caption>å­£åº¦è´¢æŠ¥æ•°æ®è¡¨</caption>
    <thead>
      <tr>
        <th>å­£åº¦</th>
        <th>è¥æ”¶</th>
        <th>EPS</th>
        <th>åŒæ¯”å¢é•¿</th>
      </tr>
    </thead>
    <tbody>
      {processedData.map(item => (
        <tr key={item.quarter}>
          <td>{item.quarter}</td>
          <td>{formatCurrency(item.revenue)}</td>
          <td>{item.eps ? `$${item.eps}` : 'N/A'}</td>
          <td>{item.revenueGrowth ? `${item.revenueGrowth}%` : 'N/A'}</td>
        </tr>
      ))}
    </tbody>
  </table>
</div>
```

**ä¼˜å…ˆçº§**: P2  
**é¢„ä¼°å·¥ä½œé‡**: 3å°æ—¶

---

### 11. ä»£ç å¤ç”¨é—®é¢˜

**ä½ç½®**: `page.tsx:164-170`, `EarningsTrendChart.tsx:52-58`

**é—®é¢˜åˆ†æ**:
- `formatCurrency` å‡½æ•°åœ¨å¤šå¤„é‡å¤å®šä¹‰
- ä¸å…¨å±€ utils ä¸­çš„æ ¼å¼åŒ–å‡½æ•°ä¸ä¸€è‡´

**å½“å‰ä»£ç **:
```typescript
// page.tsx
function formatCurrency(value: number | null): string {
  // ... å®ç°
}

// EarningsTrendChart.tsx
function formatCurrency(value: number | null): string {
  // ... å®Œå…¨ç›¸åŒçš„å®ç°
}
```

**ä¿®å¤å»ºè®®**:

```typescript
// ç»Ÿä¸€ä½¿ç”¨å…¨å±€å·¥å…·å‡½æ•°
import { formatCurrency, formatPercentage } from '@/lib/format';

// æˆ–åœ¨ utils.ts ä¸­å¯¼å‡º
export { formatCurrency } from '@/lib/utils';
```

**ä¼˜å…ˆçº§**: P2  
**é¢„ä¼°å·¥ä½œé‡**: 30åˆ†é’Ÿ

---

### 12. ç¼ºå°‘åŠ è½½å’Œé”™è¯¯çŠ¶æ€

**ä½ç½®**: `page.tsx:286-314`

**é—®é¢˜åˆ†æ**:
- å›¾è¡¨æ•°æ®åŠ è½½æ—¶æ²¡æœ‰éª¨æ¶å±æˆ–åŠ è½½æŒ‡ç¤ºå™¨
- æ•°æ®è·å–å¤±è´¥æ—¶æ²¡æœ‰å‹å¥½çš„é”™è¯¯æç¤º
- ç©ºæ•°æ®çŠ¶æ€å¤„ç†ä¸å®Œå–„

**ä¿®å¤å»ºè®®**:

```typescript
// åœ¨ EarningsTrendChart ä¸­æ·»åŠ çŠ¶æ€å¤„ç†
interface EarningsTrendChartProps {
  data: TrendData[];
  isLoading?: boolean;
  error?: Error | null;
  // ...
}

// åŠ è½½çŠ¶æ€
{isLoading && (
  <div className="h-[300px] flex items-center justify-center">
    <ChartSkeleton />
  </div>
)}

// é”™è¯¯çŠ¶æ€
{error && (
  <div className="h-[300px] flex flex-col items-center justify-center text-center p-4">
    <AlertCircle className="h-8 w-8 text-red-500 mb-2" />
    <p className="text-sm text-muted-foreground">åŠ è½½å›¾è¡¨æ•°æ®å¤±è´¥</p>
    <Button variant="outline" size="sm" onClick={onRetry} className="mt-2">
      é‡è¯•
    </Button>
  </div>
)}

// ç©ºæ•°æ®çŠ¶æ€
{!isLoading && !error && processedData.length === 0 && (
  <div className="h-[300px] flex flex-col items-center justify-center text-center p-4">
    <BarChart3 className="h-8 w-8 text-muted-foreground mb-2" />
    <p className="text-sm text-muted-foreground">æ‰€é€‰æ—¶é—´èŒƒå›´å†…æ— æ•°æ®</p>
  </div>
)}
```

**ä¼˜å…ˆçº§**: P2  
**é¢„ä¼°å·¥ä½œé‡**: 1.5å°æ—¶

---

### 13. æ•°æ®åˆ·æ–°æœºåˆ¶ç¼ºå¤±

**ä½ç½®**: `page.tsx:106-144`

**é—®é¢˜åˆ†æ**:
- æ•°æ®åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶è·å–
- æ²¡æœ‰è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
- ç”¨æˆ·æ— æ³•æ‰‹åŠ¨åˆ·æ–°æ•°æ®

**ä¿®å¤å»ºè®®**:

```typescript
// 1. æ·»åŠ è‡ªåŠ¨åˆ·æ–°
useEffect(() => {
  const interval = setInterval(() => {
    // æ¯5åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡
    fetchData();
  }, 5 * 60 * 1000);
  
  return () => clearInterval(interval);
}, [symbol]);

// 2. æ‰‹åŠ¨åˆ·æ–°æŒ‰é’®
const [isRefreshing, setIsRefreshing] = useState(false);

const handleRefresh = async () => {
  setIsRefreshing(true);
  await fetchData();
  setIsRefreshing(false);
};

// 3. ä½¿ç”¨ SWR æˆ– React Query ä¼˜åŒ–æ•°æ®è·å–
const { data, error, isLoading, mutate } = useSWR(
  `/api/earnings?symbol=${symbol}`,
  fetcher,
  { refreshInterval: 5 * 60 * 1000 } // 5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°
);
```

**ä¼˜å…ˆçº§**: P3  
**é¢„ä¼°å·¥ä½œé‡**: 2å°æ—¶

---

### 14. ç¼ºå°‘æ•°æ®å¯¹æ¯”åŠŸèƒ½

**é—®é¢˜åˆ†æ**:
- æ— æ³•åŒæ—¶å¯¹æ¯”å¤šå®¶å…¬å¸çš„è¶‹åŠ¿
- æ— æ³•å¯¹æ¯”ä¸åŒå­£åº¦çš„è¯¦ç»†æ•°æ®

**ä¿®å¤å»ºè®®**:

```typescript
// æ·»åŠ å…¬å¸å¯¹æ¯”æ¨¡å¼
interface ComparisonData {
  company: string;
  data: TrendData[];
  color: string;
}

// å¤šçº¿å›¾è¡¨
<LineChart data={mergedData}>
  {companies.map(company => (
    <Line
      key={company.symbol}
      type="monotone"
      dataKey={`${company.symbol}_revenue`}
      stroke={company.color}
      name={company.name}
    />
  ))}
</LineChart>

// å­£åº¦å¯¹æ¯”è¯¦æƒ…
const QuarterComparison = ({ quarters }: { quarters: string[] }) => {
  const selectedQuarters = processedData.filter(d => quarters.includes(d.quarter));
  return (
    <ComparisonTable data={selectedQuarters} />
  );
};
```

**ä¼˜å…ˆçº§**: P3  
**é¢„ä¼°å·¥ä½œé‡**: 4å°æ—¶

---

### 15. å›¾è¡¨é…ç½®æŒä¹…åŒ–

**é—®é¢˜åˆ†æ**:
- ç”¨æˆ·é€‰æ‹©çš„å›¾è¡¨ç±»å‹ã€æ—¶é—´èŒƒå›´åœ¨é¡µé¢åˆ·æ–°åä¸¢å¤±
- æ— æ³•ä¿å­˜ç”¨æˆ·åå¥½è®¾ç½®

**ä¿®å¤å»ºè®®**:

```typescript
// ä½¿ç”¨ localStorage æŒä¹…åŒ–é…ç½®
const [chartConfig, setChartConfig] = useState<ChartConfig>(() => {
  if (typeof window !== 'undefined') {
    const saved = localStorage.getItem(`chart-config-${symbol}`);
    return saved ? JSON.parse(saved) : defaultConfig;
  }
  return defaultConfig;
});

useEffect(() => {
  localStorage.setItem(`chart-config-${symbol}`, JSON.stringify({
    chartType,
    dataType,
    timeRange,
  }));
}, [chartType, dataType, timeRange, symbol]);
```

**ä¼˜å…ˆçº§**: P3  
**é¢„ä¼°å·¥ä½œé‡**: 1å°æ—¶

---

## ğŸ“Š æœ€ä½³å®è·µå¯¹æ¯”

### ä¸é¡¹ç›®ä¸­å…¶ä»–å›¾è¡¨ç»„ä»¶å¯¹æ¯”

| ç‰¹æ€§ | EarningsTrendChart | IndustryComparisonChart | DuPontAnalysisChart |
|------|-------------------|------------------------|-------------------|
| åŠ¨ç”»æ§åˆ¶ | âŒ å›ºå®š1ç§’ | âŒ å›ºå®š1ç§’ | âŒ å›ºå®š1ç§’ |
| ç§»åŠ¨ç«¯é€‚é… | âŒ ä¸è¶³ | âš ï¸ ä¸€èˆ¬ | âš ï¸ ä¸€èˆ¬ |
| å¯è®¿é—®æ€§ | âŒ ç¼ºå¤± | âŒ ç¼ºå¤± | âŒ ç¼ºå¤± |
| é”™è¯¯å¤„ç† | âŒ ç¼ºå¤± | âŒ ç¼ºå¤± | âŒ ç¼ºå¤± |
| æ•°æ®å¯¼å‡º | âœ… æœ‰ | âŒ æ—  | âŒ æ—  |
| æ€§èƒ½ä¼˜åŒ– | âŒ useMemoä¸å½“ | âœ… è‰¯å¥½ | âœ… memo |

### è¡Œä¸šæœ€ä½³å®è·µ

1. **æ€§èƒ½ä¼˜å…ˆ**:
   - Airbnb çš„ Visx ä½¿ç”¨ canvas æ¸²æŸ“å¤§æ•°æ®é‡
   - Uber çš„ React-Vis æä¾›è™šæ‹ŸåŒ–æ”¯æŒ

2. **äº¤äº’è®¾è®¡**:
   - TradingView çš„å›¾è¡¨æ”¯æŒç¼©æ”¾ã€å¹³ç§»ã€åå­—å‡†çº¿
   - Yahoo Finance æä¾›æ•°æ®ç‚¹è¯¦æƒ…å¼¹çª—

3. **å¯è®¿é—®æ€§**:
   - æä¾›æ•°æ®è¡¨æ ¼ä½œä¸ºå›¾è¡¨çš„æ›¿ä»£
   - æ”¯æŒé”®ç›˜å¯¼èˆªå’Œå±å¹•é˜…è¯»å™¨

---

## ğŸ“… ä¿®å¤è®¡åˆ’

### ç¬¬1å‘¨ (P0 é—®é¢˜)
- [ ] ä¿®å¤ç¯æ¯”è®¡ç®—è¾¹ç•Œæƒ…å†µ (3å°æ—¶)
- [ ] ä¿®å¤æ—¶é—´èŒƒå›´è¿‡æ»¤é€»è¾‘ (30åˆ†é’Ÿ)
- [ ] ä¼˜åŒ– useMemo ç¼“å­˜ç­–ç•¥ (2å°æ—¶)

### ç¬¬2å‘¨ (P1 é—®é¢˜)
- [ ] å›¾è¡¨åŠ¨ç”»æ€§èƒ½ä¼˜åŒ– (1å°æ—¶)
- [ ] å·¥å…·æç¤ºå®šä½ä¿®å¤ (1.5å°æ—¶)
- [ ] ç§»åŠ¨ç«¯é€‚é…æ”¹è¿› (2å°æ—¶)
- [ ] æ·»åŠ æ•°æ®ç‚¹äº¤äº’ (2å°æ—¶)

### ç¬¬3å‘¨ (P2 é—®é¢˜)
- [ ] å¯¼å‡ºåŠŸèƒ½å¢å¼º (2å°æ—¶)
- [ ] æ·»åŠ å¯è®¿é—®æ€§æ”¯æŒ (3å°æ—¶)
- [ ] ç»Ÿä¸€ä»£ç å¤ç”¨ (30åˆ†é’Ÿ)
- [ ] åŠ è½½å’Œé”™è¯¯çŠ¶æ€ (1.5å°æ—¶)

### ç¬¬4å‘¨ (P3 é—®é¢˜)
- [ ] æ•°æ®åˆ·æ–°æœºåˆ¶ (2å°æ—¶)
- [ ] é…ç½®æŒä¹…åŒ– (1å°æ—¶)
- [ ] æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ– (2å°æ—¶)

---

## ğŸ¯ é¢„æœŸæ”¶ç›Š

ä¿®å¤å®Œæˆåï¼Œé¢„æœŸè·å¾—ä»¥ä¸‹æ”¹è¿›ï¼š

| æŒ‡æ ‡ | å½“å‰ | ä¿®å¤å | æå‡ |
|------|------|--------|------|
| å›¾è¡¨æ¸²æŸ“æ—¶é—´ (å¤§æ•°æ®é‡) | 800ms | 200ms | 75% â†“ |
| ç§»åŠ¨ç«¯ FPS | 30 | 55 | 83% â†‘ |
| Lighthouse æ€§èƒ½ | 65 | 85 | +20 |
| å¯è®¿é—®æ€§è¯„åˆ† | 0 | 90 | +90 |
| ç”¨æˆ·äº¤äº’å“åº” | æ…¢ | å³æ—¶ | æ˜¾è‘—æå‡ |

---

## ğŸ“ å»ºè®®çš„æ–°å¢æ–‡ä»¶

```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ charts/
â”‚       â”œâ”€â”€ ChartTooltip.tsx          # ä¼˜åŒ–çš„å·¥å…·æç¤º
â”‚       â”œâ”€â”€ ChartSkeleton.tsx         # åŠ è½½éª¨æ¶å±
â”‚       â””â”€â”€ ChartErrorBoundary.tsx    # é”™è¯¯è¾¹ç•Œ
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useChartData.ts               # å›¾è¡¨æ•°æ®ç®¡ç†
â”‚   â”œâ”€â”€ useChartAnimation.ts          # åŠ¨ç”»æ§åˆ¶
â”‚   â””â”€â”€ useMediaQuery.ts              # å“åº”å¼æ£€æµ‹
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ format.ts                     # ç»Ÿä¸€æ ¼å¼åŒ–å‡½æ•°
â”‚   â””â”€â”€ chart-calculations.ts         # å›¾è¡¨è®¡ç®—å·¥å…·
â””â”€â”€ types/
    â””â”€â”€ chart.ts                      # å›¾è¡¨ç±»å‹å®šä¹‰
```

---

## ğŸ”— ç›¸å…³èµ„æº

- [Recharts æ€§èƒ½ä¼˜åŒ–æŒ‡å—](https://recharts.org/en-US/guide/performance)
- [æ•°æ®å¯è§†åŒ–å¯è®¿é—®æ€§æœ€ä½³å®è·µ](https://www.w3.org/WAI/tutorials/images/complex/)
- [React æ€§èƒ½ä¼˜åŒ–](https://react.dev/learn/render-and-commit)
- [ç§»åŠ¨ä¼˜å…ˆçš„å›¾è¡¨è®¾è®¡](https://www.nngroup.com/articles/mobile-charts/)

---

**æŠ¥å‘Šç”Ÿæˆ**: 2026-02-12  
**åˆ†æå¸ˆ**: Sisyphus AI Agent  
**ç‰ˆæœ¬**: v1.0

---

## é™„å½•: å…³é”®ä»£ç æ®µç´¢å¼•

### EarningsTrendChart.tsx
- ç¬¬70-79è¡Œ: `calculateQoQGrowth` å‡½æ•°
- ç¬¬81-179è¡Œ: `CustomTooltip` ç»„ä»¶
- ç¬¬191-197è¡Œ: `processedData` useMemo
- ç¬¬277-326è¡Œ: `ComposedChart` åŒè½´å›¾è¡¨
- ç¬¬397-498è¡Œ: ä¸»ç»„ä»¶æ¸²æŸ“

### page.tsx
- ç¬¬98è¡Œ: `activeTab` state
- ç¬¬164-170è¡Œ: `trendData` è®¡ç®—
- ç¬¬286-314è¡Œ: å­£åº¦è¶‹åŠ¿å¯¹æ¯”æ¨¡å— JSX
- ç¬¬313è¡Œ: `EarningsTrendChart` ç»„ä»¶è°ƒç”¨
